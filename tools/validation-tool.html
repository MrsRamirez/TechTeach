<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson Data Validation Tool</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .summary {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        .unit-section {
            margin: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
        }
        .unit-header {
            background: #e9ecef;
            padding: 15px;
            font-weight: bold;
            font-size: 1.1em;
        }
        .lesson-row {
            padding: 10px 15px;
            border-bottom: 1px solid #f1f3f4;
            display: grid;
            grid-template-columns: 80px 1fr 120px;
            gap: 15px;
            align-items: center;
        }
        .lesson-row:last-child {
            border-bottom: none;
        }
        .lesson-row.complete {
            background: #d4edda;
        }
        .lesson-row.incomplete {
            background: #f8d7da;
        }
        .lesson-row.empty {
            background: #fff3cd;
        }
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            text-align: center;
        }
        .status-complete {
            background: #28a745;
            color: white;
        }
        .status-incomplete {
            background: #dc3545;
            color: white;
        }
        .status-empty {
            background: #ffc107;
            color: #212529;
        }
        .missing-fields {
            font-size: 0.8em;
            color: #6c757d;
            margin-top: 5px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .export-section {
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        .template-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Lesson Data Validation Tool</h1>
            <p>Analyze your curriculum data and identify missing lesson information</p>
        </div>

        <div class="summary">
            <div class="stats" id="stats">
                <!-- Stats will be inserted here -->
            </div>
        </div>

        <div id="validation-results">
            <!-- Validation results will be inserted here -->
        </div>

        <div class="export-section">
            <h3>üìã Generate Templates</h3>
            <p>Create templates for missing lessons to help you fill in the data:</p>
            <button class="btn btn-primary" onclick="generateIncompleteTemplate()">üìù Generate Template for Incomplete Lessons</button>
            <button class="btn btn-warning" onclick="generateEmptyTemplate()">üìÑ Generate Template for Empty Lessons</button>
            <button class="btn btn-success" onclick="generateCompleteStructure()">üèóÔ∏è Generate Complete Unit Structure</button>
            
            <div id="template-output"></div>
        </div>
    </div>

    <script>
        let lessonData = null;
        let validationReport = null;

        // Required fields for a complete lesson
        const REQUIRED_FIELDS = [
            'day', 'date', 'lesson', 'enduringUnderstanding', 'essentialQuestion',
            'objectives', 'agenda', 'materials', 'assessment', 'differentiation'
        ];

        async function loadData() {
            try {
                const response = await fetch('../data/complete_lesson_plan.json');
                if (!response.ok) throw new Error('Failed to load data');
                lessonData = await response.json();
                validateData();
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('validation-results').innerHTML = 
                    '<div style="padding: 20px; color: red;">Error loading lesson data. Make sure the server is running.</div>';
            }
        }

        function validateData() {
            if (!lessonData || !lessonData.curriculum || !lessonData.curriculum.units) {
                return;
            }

            validationReport = {
                totalUnits: lessonData.curriculum.units.length,
                totalLessons: 0,
                completeLessons: 0,
                incompleteLessons: 0,
                emptyLessons: 0,
                units: []
            };

            lessonData.curriculum.units.forEach(unit => {
                const unitReport = {
                    unitNumber: unit.unitNumber,
                    unitTitle: unit.unitTitle,
                    totalLessons: unit.lessons ? unit.lessons.length : 0,
                    completeLessons: 0,
                    incompleteLessons: 0,
                    emptyLessons: 0,
                    lessons: []
                };

                if (unit.lessons) {
                    unit.lessons.forEach((lesson, index) => {
                        const lessonReport = validateLesson(lesson, index);
                        unitReport.lessons.push(lessonReport);
                        
                        validationReport.totalLessons++;
                        unitReport.totalLessons++;
                        
                        if (lessonReport.status === 'complete') {
                            validationReport.completeLessons++;
                            unitReport.completeLessons++;
                        } else if (lessonReport.status === 'incomplete') {
                            validationReport.incompleteLessons++;
                            unitReport.incompleteLessons++;
                        } else {
                            validationReport.emptyLessons++;
                            unitReport.emptyLessons++;
                        }
                    });
                }

                validationReport.units.push(unitReport);
            });

            displayResults();
        }

        function validateLesson(lesson, index) {
            const missingFields = [];
            const presentFields = [];

            REQUIRED_FIELDS.forEach(field => {
                if (!lesson || !lesson[field] || lesson[field] === null || lesson[field] === '') {
                    missingFields.push(field);
                } else {
                    presentFields.push(field);
                }
            });

            let status;
            if (missingFields.length === 0) {
                status = 'complete';
            } else if (presentFields.length === 0 || (presentFields.length === 1 && presentFields[0] === 'differentiation')) {
                status = 'empty';
            } else {
                status = 'incomplete';
            }

            return {
                index,
                lesson,
                status,
                missingFields,
                presentFields,
                completionPercentage: Math.round((presentFields.length / REQUIRED_FIELDS.length) * 100)
            };
        }

        function displayResults() {
            // Display stats
            const statsHtml = `
                <div class="stat-card">
                    <div class="stat-number" style="color: #28a745;">${validationReport.completeLessons}</div>
                    <div>Complete Lessons</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #dc3545;">${validationReport.incompleteLessons}</div>
                    <div>Incomplete Lessons</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #ffc107;">${validationReport.emptyLessons}</div>
                    <div>Empty Lessons</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #007bff;">${validationReport.totalLessons}</div>
                    <div>Total Lessons</div>
                </div>
            `;
            document.getElementById('stats').innerHTML = statsHtml;

            // Display detailed results
            let resultsHtml = '';
            validationReport.units.forEach(unit => {
                resultsHtml += `
                    <div class="unit-section">
                        <div class="unit-header">
                            Unit ${unit.unitNumber}: ${unit.unitTitle}
                            <span style="float: right;">
                                ‚úÖ ${unit.completeLessons} | ‚ùå ${unit.incompleteLessons} | ‚ö†Ô∏è ${unit.emptyLessons}
                            </span>
                        </div>
                `;

                unit.lessons.forEach(lessonReport => {
                    const lesson = lessonReport.lesson;
                    const statusClass = lessonReport.status;
                    const statusText = lessonReport.status.charAt(0).toUpperCase() + lessonReport.status.slice(1);
                    
                    resultsHtml += `
                        <div class="lesson-row ${statusClass}">
                            <div>
                                ${lesson && lesson.day ? `Day ${lesson.day}` : `Index ${lessonReport.index + 1}`}
                            </div>
                            <div>
                                <div>${lesson && lesson.lesson ? lesson.lesson : 'No title'}</div>
                                <div class="missing-fields">
                                    ${lessonReport.missingFields.length > 0 ? 
                                        `Missing: ${lessonReport.missingFields.join(', ')}` : 
                                        'All fields present'
                                    }
                                </div>
                            </div>
                            <div>
                                <div class="status-badge status-${statusClass}">
                                    ${statusText} (${lessonReport.completionPercentage}%)
                                </div>
                            </div>
                        </div>
                    `;
                });

                resultsHtml += '</div>';
            });

            document.getElementById('validation-results').innerHTML = resultsHtml;
        }

        function generateIncompleteTemplate() {
            let template = '{\n  "curriculum": {\n    "units": [\n';
            
            validationReport.units.forEach((unit, unitIndex) => {
                const incompleteLessons = unit.lessons.filter(l => l.status === 'incomplete');
                if (incompleteLessons.length > 0) {
                    template += `      {\n        "unitNumber": ${unit.unitNumber},\n        "unitTitle": "${unit.unitTitle}",\n        "lessons": [\n`;
                    
                    incompleteLessons.forEach((lessonReport, lessonIndex) => {
                        template += generateLessonTemplate(lessonReport.lesson, lessonReport.missingFields);
                        if (lessonIndex < incompleteLessons.length - 1) template += ',';
                        template += '\n';
                    });
                    
                    template += '        ]\n      }';
                    if (unitIndex < validationReport.units.length - 1) template += ',';
                    template += '\n';
                }
            });
            
            template += '    ]\n  }\n}';
            
            displayTemplate('Incomplete Lessons Template', template);
        }

        function generateEmptyTemplate() {
            let template = '{\n  "curriculum": {\n    "units": [\n';
            
            validationReport.units.forEach((unit, unitIndex) => {
                const emptyLessons = unit.lessons.filter(l => l.status === 'empty');
                if (emptyLessons.length > 0) {
                    template += `      {\n        "unitNumber": ${unit.unitNumber},\n        "unitTitle": "${unit.unitTitle}",\n        "lessons": [\n`;
                    
                    emptyLessons.forEach((lessonReport, lessonIndex) => {
                        template += generateLessonTemplate({}, REQUIRED_FIELDS, lessonReport.index + 1);
                        if (lessonIndex < emptyLessons.length - 1) template += ',';
                        template += '\n';
                    });
                    
                    template += '        ]\n      }';
                    if (unitIndex < validationReport.units.length - 1) template += ',';
                    template += '\n';
                }
            });
            
            template += '    ]\n  }\n}';
            
            displayTemplate('Empty Lessons Template', template);
        }

        function generateCompleteStructure() {
            let template = `{
  "curriculum": {
    "course": "${lessonData.curriculum.course}",
    "schoolYear": "${lessonData.curriculum.schoolYear}",
    "units": [
`;
            
            validationReport.units.forEach((unit, unitIndex) => {
                template += `      {
        "unitNumber": ${unit.unitNumber},
        "unitTitle": "${unit.unitTitle}",
        "lessons": [
`;
                
                // Generate templates for all lessons, complete or not
                unit.lessons.forEach((lessonReport, lessonIndex) => {
                    const lesson = lessonReport.lesson;
                    if (lessonReport.status === 'complete') {
                        // Keep existing complete lesson
                        template += '          ' + JSON.stringify(lesson, null, 2).replace(/\n/g, '\n          ');
                    } else {
                        // Generate template for incomplete/empty lesson
                        template += generateLessonTemplate(lesson || {}, lessonReport.missingFields, lessonReport.index + 1);
                    }
                    
                    if (lessonIndex < unit.lessons.length - 1) template += ',';
                    template += '\n';
                });
                
                template += '        ]\n      }';
                if (unitIndex < validationReport.units.length - 1) template += ',';
                template += '\n';
            });
            
            template += '    ]\n  ]\n}';
            
            displayTemplate('Complete Structure Template', template);
        }

        function generateLessonTemplate(existingLesson = {}, missingFields = REQUIRED_FIELDS, dayNumber = null) {
            const template = {
                day: existingLesson.day || dayNumber || "[DAY_NUMBER]",
                date: existingLesson.date || "[DATE - e.g., Mon, 09 08, 25]",
                lesson: existingLesson.lesson || "[LESSON_TITLE]",
                enduringUnderstanding: existingLesson.enduringUnderstanding || "[ENDURING_UNDERSTANDING]",
                essentialQuestion: existingLesson.essentialQuestion || "[ESSENTIAL_QUESTION]",
                objectives: existingLesson.objectives || ["[OBJECTIVE_1]", "[OBJECTIVE_2]", "[OBJECTIVE_3]"],
                agenda: existingLesson.agenda || "[AGENDA - e.g., (5m) Do Now: [ACTIVITY] (20m) Mini-Lesson: [TOPIC] (45m) Guided Practice: [ACTIVITY]]",
                materials: existingLesson.materials || {
                    teacher: "[TEACHER_MATERIALS]",
                    student: "[STUDENT_MATERIALS]",
                    links: "[LINKS_AND_RESOURCES]"
                },
                assessment: existingLesson.assessment || {
                    formative: "[FORMATIVE_ASSESSMENT]",
                    summative: "[SUMMATIVE_ASSESSMENT]"
                },
                differentiation: existingLesson.differentiation || "[DIFFERENTIATION - Support: [SUPPORT_STRATEGIES] Challenge: [CHALLENGE_STRATEGIES]]"
            };
            
            return '          ' + JSON.stringify(template, null, 2).replace(/\n/g, '\n          ');
        }

        function displayTemplate(title, template) {
            const output = document.getElementById('template-output');
            output.innerHTML = `
                <h4>${title}</h4>
                <div class="template-preview">${template}</div>
                <button class="btn btn-primary" onclick="copyToClipboard(\`${template.replace(/`/g, '\\`')}\`)">üìã Copy to Clipboard</button>
                <button class="btn btn-success" onclick="downloadTemplate('${title.toLowerCase().replace(/\s+/g, '_')}.json', \`${template.replace(/`/g, '\\`')}\`)">üíæ Download JSON</button>
            `;
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Template copied to clipboard!');
            });
        }

        function downloadTemplate(filename, content) {
            const blob = new Blob([content], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
